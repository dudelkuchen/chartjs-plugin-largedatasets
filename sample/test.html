<!doctype html>
<html>

<head>
    <title>chartjs-plugin-largdataset</title>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.24.0/min/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-crosshair"></script>
	<script src="../src/largedata.js"></script>
	<style>
		canvas {
			-moz-user-select: none;
			-webkit-user-select: none;
			-ms-user-select: none;
		}
		.chart {
			margin: auto;
			width: 75%;
		}
		.text-center {
			text-align: center;
		}
	</style>
</head>

<body>
	<div class="chart">
        <canvas id="myChart"></canvas>
        <canvas id="mySecoundChart"></canvas>
	</div>
	<div>
		<p class="text-center">
			<button id="randomizeData">Randomize Data</button>
			<button id="addDataset">Add Dataset</button>
			<button id="removeDataset">Remove Dataset</button>
			<button id="addData">Add Data</button>
		</p>
	</div>

	<script>
        var minValue = 0;
        var maxValue = 0;
		var chartColors = {
			red: 'rgb(255, 99, 132)',
			orange: 'rgb(255, 159, 64)',
			yellow: 'rgb(255, 205, 86)',
			green: 'rgb(75, 192, 192)',
			blue: 'rgb(54, 162, 235)',
			purple: 'rgb(153, 102, 255)',
			grey: 'rgb(201, 203, 207)'
		};

		var color = Chart.helpers.color;
		var config = {
			type: 'line',
			data: {
				datasets: [{
					label: 'Dataset 1 (linear interpolation)',
					backgroundColor: color(chartColors.red).alpha(0.5).rgbString(),
					borderColor: chartColors.red,
					fill: false,
					lineTension: 0,
					radius: 0,
					data: [],
				}]
			},
			options: {
                plugins: {
					largeDatasets: {
						groupSize: 2,
						keepFullData: true,
					},
					crosshair: {
						line: {
						color: '#F66',  // crosshair line color
						width: 1        // crosshair line width
						},
						sync: {
						enabled: true,            // enable trace line syncing with other charts
						group: 1,                 // chart group
						suppressTooltips: false   // suppress tooltips when showing a synced tracer
						},
						zoom: {
						enabled: true,                                      // enable zooming
						zoomboxBackgroundColor: 'rgba(66,133,244,0.2)',     // background color of zoom box 
						zoomboxBorderColor: '#48F',                         // border color of zoom box
						zoomButtonText: 'Reset Zoom',                       // reset zoom button text
						zoomButtonClass: 'reset-zoom',                      // reset zoom button class
						},
						callbacks: {
						beforeZoom: function(start, end) {                  // called before zoom, return false to prevent zoom
							return true;
						},
						afterZoom: function(start, end) {                   // called after zoom
						}
						}
					}

                },
				title: {
					display: true,
					text: 'Line chart (hotizontal scroll) sample'
				},
				scales: {
					xAxes: [{
                        type: "time",
						scaleLabel: {
							display: true,
							labelString: 'value'
						}
					}],
					yAxes: [{
						scaleLabel: {
							display: true,
							labelString: 'value'
						}
					}]
				},
				tooltips: {
					mode: 'nearest',
      				intersect: false
				},
				hover: {
					mode: 'nearest',
					intersect: false
				}
			}
		};
		window.onload = function() {
            var ctx = document.getElementById('myChart').getContext('2d');
            var time = Date.now();
			var data = 5;
			var start = Date.now()
            for (var i = 0; i < 100000; i++) {
                time += 5000;
                data += Math.floor(Math.random() * (100 - (-100) + 1)) + (-100);
				config.data.datasets[0].data.push({
						x: time,
						y: data
					});
			}
			var end = Date.now();
			console.log("Initialisation: " + (start - end) / 1000)
            var config2= JSON.parse(JSON.stringify(config));
			start = Date.now();
			window.myChart = new Chart(ctx, config);
			end = Date.now();
			console.log("Reduced Chart: " + (start - end) / 1000);
            var ctx2 = document.getElementById('mySecoundChart').getContext('2d');
			//config2.options["plugins"]["largeDatasets"] = false;
			config2.options["plugins"]["largeDatasets"]["pixelSize"] = 1;
			start = Date.now();

			// Chart without optimization
			//window.myChart = new Chart(ctx2, config2);
			end = Date.now();
			console.log("Full Chart: " + (start - end) / 1000);
		};
	</script>
</body>

</html>